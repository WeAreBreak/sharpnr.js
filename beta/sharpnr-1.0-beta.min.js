//Copyright (c) Ádám Juhos, Balázs Schwarzkopf. License: http://www.sharpnrjs.com/home/license.
var sharpnr={};"use strict";function eval_global(codetoeval){if(window.execScript)window.execScript("sharpnr.$$code_evaled = "+codetoeval,"");else sharpnr.$$code_evaled=eval(codetoeval);return sharpnr.$$code_evaled}function async(a){return sharpnr.await.compiler.compile(a)}function foreach(a,b,c){}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;c<d;c++){if(this[c]===a){return c}}return-1}}sharpnr.$$code_evaled=0;sharpnr.parser={};sharpnr.parser.isNumber=function(a){return/^[0-9]$/.test(a)};sharpnr.parser.isLetter=function(a){return/^[a-z]$/.test(a)};sharpnr.parser.isIdentifierStart=function(a){return/^[a-z_\$\\]$/.test(a)};sharpnr.parser.isAlphanumeric=function(a){return/^[a-z0-9]$/.test(a)};sharpnr.parser.isSeparator=function(a){return["."," ","\n","\r","	",",",";","(","[","+","-","*","/","\\","&","|","~","^","<",">",":","=","!","%",")","]","{","}"].indexOf(a)!=-1};sharpnr.parser.findIdentifier=function(a,b){if(!b){b=0}var c="";var d=sharpnr.parser.createParserState();d.inIdentifier=false;var e=a+" ";for(var f=b;f<e.length;f++){d.lastChar=d.char;d.char=e.charAt(f);if(!sharpnr.parser.ensureProcessable(d)){continue}if(sharpnr.parser.isSeparator(d.char)&&d.char!="."){if(d.inIdentifier){return{output:c,cursor:f-c.length}}continue}if(sharpnr.parser.isIdentifierStart(d.char)&&!d.inIdentifier){d.inIdentifier=true;c=d.char;continue}if(d.inIdentifier){c+=d.char;continue}else{break}}return{output:"",cursor:-1}};sharpnr.parser.findIdentifierFirst=function(a,b,c){if(!c){c=0}var d="";var e=sharpnr.parser.createParserState();e.inIdentifier=false;var f=a+" ";for(var g=c;g<f.length;g++){e.lastChar=e.char;e.char=f.charAt(g);if(!sharpnr.parser.ensureProcessable(e)){continue}if(sharpnr.parser.isSeparator(e.char)&&e.char!="."){if(e.inIdentifier){if(d==b){return g-d.length}else{e.inIdentifier=false;d=""}}continue}if(sharpnr.parser.isIdentifierStart(e.char)&&!e.inIdentifier){e.inIdentifier=true;d=e.char;continue}if(e.inIdentifier){d+=e.char;continue}}return-1};sharpnr.parser.findIdentifierFirstOnLevel=function(a,b,c,d){if(!d){d=0}if(!c){c=0}var e="";var f=sharpnr.parser.createParserState();f.inIdentifier=false;f.segmentLevel=0;var g=a+" ";for(var h=d;h<g.length;h++){f.lastChar=f.char;f.char=g.charAt(h);if(!sharpnr.parser.ensureProcessable(f)){continue}if(f.char=="("){f.segmentLevel++;continue}if(f.char==")"){if(f.segmentLevel>=1){f.segmentLevel--;continue}else if(e==b&&f.segmentLevel==c&&f.blockLevel==0){return h-e.length}else{return-1}}if(f.char=="{"||f.char=="}"){if(e==b&&f.segmentLevel==c&&f.blockLevel==0){return h-e.length}else{return-1}}if(sharpnr.parser.isSeparator(f.char)&&f.char!="."){if(f.inIdentifier){if(e==b&&f.segmentLevel==c&&f.blockLevel==0){return h-e.length}else{f.inIdentifier=false;e=""}}continue}if(sharpnr.parser.isIdentifierStart(f.char)&&!f.inIdentifier){f.inIdentifier=true;e=f.char;continue}if(f.inIdentifier){e+=f.char;continue}}return-1};sharpnr.parser.findIdentifierBack=function(a,b){if(!b){b=0}var c="";var d=sharpnr.parser.createParserState();d.inIdentifier=false;var e=a+" ";for(var f=b;f>0;f--){d.lastChar=e[f-1];d.char=e.charAt(f);if(!sharpnr.parser.ensureProcessableBack(d)){continue}if(sharpnr.parser.isSeparator(d.char)&&d.char!="."){if(d.inIdentifier){return{output:c,cursor:f}}continue}if(sharpnr.parser.isIdentifierStart(d.char)&&!d.inIdentifier){d.inIdentifier=true;c=d.char;continue}if(d.inIdentifier){c=d.char+c;continue}}return{output:"",cursor:-1}};sharpnr.parser.findIdentifierFirstBack=function(a,b,c){if(!c){c=0}var d="";var e=sharpnr.parser.createParserState();e.inIdentifier=false;var f=a+" ";for(var g=c;g>0;g--){e.lastChar=f[g-1];e.char=f.charAt(g);if(!sharpnr.parser.ensureProcessableBack(e)){continue}if(sharpnr.parser.isSeparator(e.char)&&e.char!="."){if(e.inIdentifier){if(d==b){return g-d.length}else{e.inIdentifier=false;d=""}}continue}if(sharpnr.parser.isIdentifierStart(e.char)&&!e.inIdentifier){e.inIdentifier=true;d=e.char;continue}if(e.inIdentifier){d=e.char+d;continue}}return-1};sharpnr.parser.findAllProcessableChars=function(a,b){if(!b){b=0}var c=sharpnr.parser.createParserState();var d="";var e=a;for(var f=b;f<e.length;f++){c.lastChar=c.char;c.char=e.charAt(f);if(!sharpnr.parser.ensureProcessable(c,{block:false,string:false})){continue}d+=c.char}return d};sharpnr.parser.findProcessableChar=function(a,b,c){if(!c){c=0}var d=sharpnr.parser.createParserState();var e=a+" ";for(var f=c;f<e.length;f++){d.lastChar=d.char;d.char=e.charAt(f);if(!sharpnr.parser.ensureProcessable(d,{block:false})){continue}if(d.char==b){return f}}return-1};sharpnr.parser.findProcessableCharOnSameLevel=function(a,b,c){if(!c){c=0}var d=sharpnr.parser.createParserState();d.segmentLevel=0;d.arrayLevel=0;var e=a+" ";for(var f=c;f<e.length;f++){d.lastChar=d.char;d.char=e.charAt(f);if(!sharpnr.parser.ensureProcessable(d,{block:false})){continue}if(d.char=="{"){if(b=="{"&&d.blockLevel==0&&d.segmentLevel==0&&d.arrayLevel==0){return f}d.blockLevel++;continue}if(d.char=="}"){if(d.blockLevel>=1){d.blockLevel--;if(b=="}"&&d.blockLevel==0&&d.segmentLevel==0&&d.arrayLevel==0){return f}continue}else{return-1}}if(d.char=="("){if(b=="("&&d.blockLevel==0&&d.segmentLevel==0&&d.arrayLevel==0){return f}d.segmentLevel++;continue}if(d.char==")"){if(d.segmentLevel>=1){d.segmentLevel--;if(b==")"&&d.blockLevel==0&&d.segmentLevel==0&&d.arrayLevel==0){return f}continue}else{return-1}}if(d.char=="("){if(b=="("&&d.blockLevel==0&&d.segmentLevel==0&&d.arrayLevel==0){return f}d.arrayLevel++;continue}if(d.char==")"){if(d.arrayLevel>=1){d.arrayLevel--;if(b==")"&&d.blockLevel==0&&d.segmentLevel==0&&d.arrayLevel==0){return f}continue}else{return-1}}if(d.char==b&&d.blockLevel==0&&d.segmentLevel==0&&d.arrayLevel==0){return f}}return-1};sharpnr.parser.findProcessableCharBack=function(a,b,c,d){if(!c){c=a.length-1}var e=sharpnr.parser.createParserState();var f=a;for(var g=c;g>0;g--){e.lastChar=f[g-1];e.char=f.charAt(g);if(!sharpnr.parser.ensureProcessableBack(e,{block:false})){continue}if(e.char==b){return g}if(d){if(d.indexOf(e.char)==-1){break}}}return-1};sharpnr.parser.findBlockEnd=function(a,b){if(!b){b=0}var c=sharpnr.parser.createParserState();var d=a+" ";for(var e=b;e<d.length;e++){c.lastChar=c.char;c.char=d.charAt(e);if(!sharpnr.parser.ensureProcessable(c)){continue}if(c.char=="}"){return e}}return a.length};sharpnr.parser.findSegmentEnd=function(a,b){if(!b){b=0}var c=sharpnr.parser.createParserState();c.segmentLevel=0;var d=a+" ";for(var e=b;e<d.length;e++){c.lastChar=c.char;c.char=d.charAt(e);if(!sharpnr.parser.ensureProcessable(c)){continue}if(c.char=="("){c.segmentLevel++;continue}if(c.char==")"){if(c.segmentLevel>=1){c.segmentLevel--;continue}else{return e}}}return a.length};sharpnr.parser.normalize=function(a,b){if(!b){b=0}var c=sharpnr.parser.createParserState();c.segmentLevel=0;var d="";var e=a+" ";for(var f=b;f<e.length;f++){c.lastChar=c.char;c.char=e.charAt(f);if(!sharpnr.parser.ensureProcessable(c)){d+=c.char;continue}if(c.char=="{"||c.char=="}"){continue}if(c.char=="("){c.segmentLevel++;d+=c.char;continue}if(c.char==")"){if(c.segmentLevel>=1){c.segmentLevel--;d+=c.char}continue}d+=c.char}return a.length};sharpnr.parser.createParserState=function(){return{"char":"",lastChar:"",inLineComment:false,inBlockComment:false,inString:false,stringChar:"",blockLevel:0}};sharpnr.parser.ensureProcessable=function(a,b){if(!b){b={block:true}}if(typeof b.block=="undefined"){b.block=true}if(typeof b.string=="undefined"){b.string=true}if(a.inString){if(a.lastChar!="\\"&&a.char==a.stringChar){a.inString=false}return false}if(a.inLineComment){if(a.char=="\n"){a.inLineComment=false}return false}if(a.inBlockComment){if(a.lastChar=="*"&&a.char=="/"){a.inBlockComment=false}return false}if(b.string){if(a.char=='"'||a.char=="'"){a.inString=true;a.stringChar=a.char;return false}}if(a.lastChar=="/"&&a.char=="/"){a.inLineComment=true;return false}if(a.lastChar=="/"&&a.char=="*"){a.inBlockComment=true;return false}if(b.block){if(a.char=="{"){a.blockLevel++;return false}if(a.char=="}"){if(a.blockLevel>=1){a.blockLevel--;return false}}}return true};sharpnr.parser.ensureProcessableBack=function(a){if(a.inString){if(a.lastChar!="\\"&&a.char==a.stringChar){a.inString=false}return false}if(a.inBlockComment){if(a.lastChar=="/"&&a.char=="*"){a.inBlockComment=false}return false}if(a.char=='"'||a.char=="'"){a.inString=true;a.stringChar=a.char;return false}if(a.lastChar=="*"&&a.char=="/"){a.inBlockComment=true;return false}if(a.char=="}"){a.blockLevel++;return false}if(a.char=="{"){if(a.blockLevel>=1){a.blockLevel--;return false}}return true};sharpnr.await={};sharpnr.await.$while=function(a,b,c){var d=[];d["break"]=c;sharpnr.await.processWhile(a,b,d)};sharpnr.await.processWhile=function(a,b,c){var d=a();if(!d){c["break"]();return}b(function(d){if(d=="continue"||d==undefined){sharpnr.await.processWhile(a,b,c)}else if(d=="break"){c["break"]()}})};sharpnr.await.$doWhile=function(a,b,c){var d=[];d["break"]=c;sharpnr.await.processDoWhile(a,b,d)};sharpnr.await.processDoWhile=function(a,b,c){b(function(d){if(d=="continue"||d==undefined){var e=a();if(!e){c["break"]();return}sharpnr.await.processDoWhile(a,b,c)}else if(d=="break"){c["break"]()}})};sharpnr.await.$for=function(a,b,c,d,e){var f=[];f["break"]=e;sharpnr.await.processFor(a,b,c,d,f)};sharpnr.await.processFor=function(a,b,c,d,e,f){if(!f){f={i:a()}}var g=b(f.i);if(!g){e["break"]();return}d(f.i,function(g){if(g=="continue"||g==undefined){f.i=c(f.i);sharpnr.await.processFor(a,b,c,d,e,f)}else if(g=="break"){e["break"]()}})};sharpnr.await.forin=function(a,b,c,d){var e=[];e["break"]=d;sharpnr.await.processForIn(a,b,c,e)};sharpnr.await.processForIn=function(a,b,c,d,e){var f=b();if(!e){e={keys:[],i:0,length:0};if(f){for(var g in f){if(typeof g=="number"||f.hasOwnProperty(g)){e.keys.push(g);e.length++}}}}if(!f||e.length<=e.i){d["break"]();return}var h=f[e.keys[e.i]];a(h);c(e.keys[e.i],function(f){if(f=="continue"||f==undefined){e.i++;sharpnr.await.processForIn(a,b,c,d,e)}else if(f=="break"){d["break"]()}})};sharpnr.await.foreach=function(a,b,c,d){var e=[];e["break"]=d;sharpnr.await.processForeach(a,b,c,e)};sharpnr.await.processForeach=function(a,b,c,d,e){var f=b();if(!e){e={keys:[],i:0,length:0};if(f){for(var g in f){if(typeof g=="number"||f.hasOwnProperty(g)){e.keys.push(g);e.length++}}}}if(!f||e.length<=e.i){d["break"]();return}var h=f[e.keys[e.i]];a(h);c(h,function(f){if(f=="continue"||f==undefined){e.i++;sharpnr.await.processForeach(a,b,c,d,e)}else if(f=="break"){d["break"]()}})};sharpnr.await.$if=function(a,b,c,d){sharpnr.await.processIf(a,b,c,d)};sharpnr.await.processIf=function(a,b,c,d){if(a.e()){a.s(d);return}else{for(var e in b){if(typeof e=="number"&&b[e].e()){b[e].s(d);return}}}if(c){c(d);return}d()};sharpnr.await.$switch=function(a,b,c,d){sharpnr.await.processSwitch(a,b,c,d)};sharpnr.await.processSwitch=function(a,b,c,d){var e=a();for(var f in b){if(typeof f=="number"&&b[f].v==e){b[f].s(d);return}}if(c){c(d);return}d()};sharpnr.await.compiler={};sharpnr.await.compiler.buildStatement=function(a,b,c){if(!b){b=0}if(!c){c={insideLoop:false}}if(typeof c.insideLoop=="undefined"){c.insideLoop=false}if(typeof c.awaitMode=="undefined"){c.awaitMode=false}var d="";var e=[];var f=sharpnr.parser.createParserState();f.hasDot=false;f.inKeyword=false;f.keyword="";var a=a+" ";for(var g=0;g<a.length;g++){f.lastChar=f.char;f.char=a.charAt(g);if(!f.inKeyword&&f.keyword!=""&&f.keyword!=undefined){var h="";if(!c.awaitMode){switch(f.keyword){case"while":h=sharpnr.await.compiler.buildWhile(a,g-f.keyword.length-1,b);break;case"do":h=sharpnr.await.compiler.buildDoWhile(a,g-f.keyword.length-1,b);break;case"for":h=sharpnr.await.compiler.buildFor(a,g-f.keyword.length-1,b);break;case"foreach":h=sharpnr.await.compiler.buildFor(a,g-f.keyword.length-1,b,{forceForeach:true});break;case"break":if(c.insideLoop){h=sharpnr.await.compiler.buildBreak(a,g-f.keyword.length-1,b)}break;case"continue":if(c.insideLoop){h=sharpnr.await.compiler.buildContinue(a,g-f.keyword.length-1,b)}break;case"if":h=sharpnr.await.compiler.buildIf(a,g-f.keyword.length-1,b);break;case"switch":h=sharpnr.await.compiler.buildSwitch(a,g-f.keyword.length-1,b);break;default:d+=f.keyword;break}}else if(f.keyword=="await"){h=sharpnr.await.compiler.buildAwait(a,g-f.keyword.length-1,b)}else{d+=f.keyword}f.keyword="";if(h!=""){b++;d+=h.output;if(e[f.blockLevel-1]){e[f.blockLevel-1]=h.outputEnd+e[f.blockLevel-1]}else{e[f.blockLevel-1]=h.outputEnd}g=h.cursor;f.char=a.charAt(g);continue}}if(!f.inKeyword){d+=f.lastChar}if(!sharpnr.parser.ensureProcessable(f)){f.inKeyword=false;if(f.char=="}"&&e[f.blockLevel]!=undefined){d+=e[f.blockLevel];e[f.blockLevel]=undefined}continue}if(f.char=="."){f.hasDot=true;f.inKeyword=false;if(f.keyword!=undefined){d+=f.keyword;f.keyword=""}continue}if(sharpnr.parser.isSeparator(f.char)){f.inKeyword=false;f.hasDot=false;continue}if(sharpnr.parser.isIdentifierStart(f.char)&&!f.hasDot&&!f.inKeyword){f.inKeyword=true;f.keyword=f.char;continue}if(f.inKeyword){f.keyword+=f.char;continue}}if(e[f.blockLevel-1]!=undefined){d+=e[f.blockLevel-1];e[f.blockLevel-1]=undefined}return d};sharpnr.await.compiler.buildWhile=function(a,b,c){var d=sharpnr.parser.findProcessableChar(a,"(",b)+1;var e=sharpnr.parser.findSegmentEnd(a,d);var f="function() { return "+a.substring(d,e)+";}";var g=sharpnr.parser.findProcessableChar(a,"{",e+1)+1;var h=sharpnr.parser.findBlockEnd(a,g);var i="function($$$cb"+c+") {"+sharpnr.await.compiler.buildStatement(a.substring(g,h)+" $$$cb"+c+"();",c+1,{insideLoop:true})+"}";var j="sharpnr.await.$while("+f+","+i+", function() {";var k="});";return{output:j,outputEnd:k,cursor:h+1}};sharpnr.await.compiler.buildDoWhile=function(a,b,c){var d=sharpnr.parser.findProcessableChar(a,"{",b)+1;var e=sharpnr.parser.findBlockEnd(a,d);var f="function($$$cb"+c+") {"+sharpnr.await.compiler.buildStatement(a.substring(d,e)+" $$$cb"+c+"();",c+1,{insideLoop:true})+"}";var g=sharpnr.parser.findProcessableChar(a,"(",e+1)+1;var h=sharpnr.parser.findSegmentEnd(a,g);var i="function() { return "+a.substring(g,h)+";}";var j="sharpnr.await.$doWhile("+i+","+f+", function() {";var k="});";return{output:j,outputEnd:k,cursor:h+2}};sharpnr.await.compiler.buildFor=function(a,b,c,d){if(!d){d={forceForeach:false}}if(!d.forceForeach){d.forceForeach=false}var e=sharpnr.parser.findProcessableChar(a,"(",b)+1;var f=sharpnr.parser.findSegmentEnd(a,e);var g=a.substring(e,f);var h=g.split(";");var i="";var j,k,l="";if(h.length==3){if(h[0]!=undefined&&h[0]!=""){var m=sharpnr.parser.findIdentifier(h[0]);if(m.output=="var"){i=sharpnr.parser.findIdentifier(h[0],m.cursor+3).output;j="function() { "+h[0]+"; return "+i+";}"}else{j="function() {}"}}else{j="function() {}"}k="function("+i+") { return "+h[1]+";}";l="function("+i+") {"+h[2]+"; return "+i+";}"}else{h=g.split(" in ");if(h.length==2){var m=sharpnr.parser.findIdentifier(h[0]);if(m.output=="var"){i=sharpnr.parser.findIdentifier(h[0],m.cursor+3).output}j="function($$$value) { "+h[0]+" = $$$value; }";k="function("+i+") { return "+h[1]+";}"}else{throw"Invalid for statement"}}var n=sharpnr.parser.findProcessableChar(a,"{",f+1)+1;var o=sharpnr.parser.findBlockEnd(a,n);var p="";if(i!=""){p="function("+i+", $$$cb"+c+") {"+sharpnr.await.compiler.buildStatement(a.substring(n,o)+" $$$cb"+c+"();",c+1,{insideLoop:true})+"}"}else{p="function($$$, $$$cb"+c+") {"+sharpnr.await.compiler.buildStatement(a.substring(n,o)+" $$$cb"+c+"();",c+1,{insideLoop:true})+"}"}var q="";if(h.length==3){q="sharpnr.await.$for("+j+","+k+","+l+","+p+", function() {"}else{q="await."+(d.forceForeach?"foreach":"forin")+"("+j+","+k+","+p+", function() {"}var r="});";return{output:q,outputEnd:r,cursor:o+1}};sharpnr.await.compiler.buildBreak=function(a,b,c){c=c-1;return{output:"$$$cb"+c+"('break'); return;",outputEnd:"",cursor:b+"break;".length}};sharpnr.await.compiler.buildContinue=function(a,b,c){c=c-1;return{output:"$$$cb"+c+"('continue'); return;",outputEnd:"",cursor:b+"continue;".length}};sharpnr.await.compiler.buildIf=function(a,b,c){var d=sharpnr.parser._buildIfInternal(a,b,c);var e=d.output;var f="sharpnr.await.$if({e:"+e.expr+", s:"+e.stmt+"}, [";var g=false;var h=false;while(true){var i=sharpnr.parser.findIdentifier(a,d.cursor);if(i.output=="else"){var j=i.cursor+4;if(sharpnr.parser.findIdentifier(a,j).output=="if"){d=sharpnr.parser._buildIfInternal(a,j,c);f+=(g?",":"")+"{e:"+d.output.expr+", s:"+d.output.stmt+"}";g=true}else{d=sharpnr.parser._buildElseInternal(a,j,c);f+="],"+d.output+",";h=true;break}}break}f+=(!h?"],null,":"")+"function() {";var k="});";return{output:f,outputEnd:k,cursor:d.cursor}};sharpnr.parser._buildIfInternal=function(a,b,c){var d=sharpnr.parser.findProcessableChar(a,"(",b)+1;var e=sharpnr.parser.findSegmentEnd(a,d);var f="function() { return "+a.substring(d,e)+";}";var g=sharpnr.parser.findProcessableChar(a,"{",e+1)+1;var h=sharpnr.parser.findBlockEnd(a,g);var i="function($$$cb"+c+") {"+sharpnr.await.compiler.buildStatement(a.substring(g,h)+" $$$cb"+c+"();",c+1)+"}";var j={expr:f,stmt:i};return{output:j,cursor:h+1}};sharpnr.parser._buildElseInternal=function(a,b,c){var d=sharpnr.parser.findProcessableChar(a,"{",b)+1;var e=sharpnr.parser.findBlockEnd(a,d);var f="function($$$cb"+c+") {"+sharpnr.await.compiler.buildStatement(a.substring(d,e)+" $$$cb"+c+"();",c+1)+"}";return{output:f,cursor:e+1}};sharpnr.await.compiler.buildSwitch=function(a,b,c){var d=sharpnr.parser.findProcessableChar(a,"(",b)+1;var e=sharpnr.parser.findSegmentEnd(a,d);var f="function() { return "+a.substring(d,e)+";}";var g="sharpnr.await.$switch("+f+", [";var h={cursor:e+1};var i=false;var j=false;while(true){var k=sharpnr.parser.findIdentifier(a,h.cursor);if(k.output=="case"){var l=k.cursor;h=sharpnr.parser._buildCaseInternal(a,l,c);g+=(i?",":"")+"{v:"+h.output.val+",s:"+h.output.stmt+"}";i=true;continue}else if(k.output=="default"){var l=k.cursor;h=sharpnr.parser._buildDefaultCaseInternal(a,l,c);g+="],"+h.output+",";j=true}break}g+=(!j?"],null,":"")+"function() {";var m="});";var n=sharpnr.parser.findProcessableChar(a,"{",b)+1;var o=sharpnr.parser.findBlockEnd(a,n);return{output:g,outputEnd:m,cursor:o+1}};sharpnr.parser._buildCaseInternal=function(a,b,c){var d=sharpnr.parser.findProcessableChar(a,":",b)+1;var e=sharpnr.parser.findIdentifierFirst(a,"break",d);var f="function($$$cb"+c+") {"+sharpnr.await.compiler.buildStatement(a.substring(d,e)+" $$$cb"+c+"();",c+1)+"}";var g=a.substring(b+"case".length,d-1);var h={val:g,stmt:f};return{output:h,cursor:e+"break".length}};sharpnr.parser._buildDefaultCaseInternal=function(a,b,c){var d=sharpnr.parser.findProcessableChar(a,":",b)+1;var e=sharpnr.parser.findIdentifierFirst(a,"break",d);var f="function($$$cb"+c+") {"+sharpnr.await.compiler.buildStatement(a.substring(d,e)+" $$$cb"+c+"();",c+1)+"}";return{output:f,cursor:e+"break".length}};sharpnr.await.compiler.buildAwait=function(a,b,c){var d=sharpnr.parser.findProcessableCharOnSameLevel(a,"(",b);var e=sharpnr.parser.findProcessableCharOnSameLevel(a,";",d);d=d-1;var f=b;var g=0;var h=-1;while(true){f=sharpnr.parser.findProcessableCharOnSameLevel(a,"(",f);if(f!=-1&&f<e){d=f+1;g=sharpnr.parser.findSegmentEnd(a,d);h=sharpnr.parser.findIdentifierFirstOnLevel(a,"$$",0,d);if(h!=-1&&h<g){break}f=g+1}else{break}}var i=sharpnr.parser.findAllProcessableChars(a.substring(d,g).replace(/ /g,"")).length>0;var j=sharpnr.parser.findProcessableChar(a," ",b)+1;var k=e+1;var l="";var m="";if(sharpnr.parser.findProcessableCharBack(a,"=",b-1,[" "])!=-1){var n=sharpnr.parser.findIdentifierBack(a,b-1);m=n.output;var o=sharpnr.parser.findIdentifierFirstBack(a,"var",n.cursor)+"var".length;if(o==-1+3&&m!=sharpnr.parser.findIdentifier(a,o).output){l=m;m=""}}var p=sharpnr.parser.findAllProcessableChars(a.substring(g+1,k-1).replace(/ /g,"")).length>0;var q="";if(p){q=(m!=""?m:"arguments[0]")+"=arguments[0]"+sharpnr.await.compiler.buildStatement(a.substring(g+1,k-1),c,{awaitMode:true})+";"}var r="";var s="";h=sharpnr.parser.findIdentifierFirstOnLevel(a,"$$",0,d);if(h==-1||h>k){r=sharpnr.await.compiler.buildStatement(a.substring(j,g),c,{awaitMode:true})+(i?",":"")+"function("+m+") {"+(l!=""?l+"=arguments[0];":"")+q;s="});"}else{r=sharpnr.await.compiler.buildStatement(a.substring(j,h),c,{awaitMode:true})+"function("+m+") {"+(l!=""?l+"=arguments[0];":"")+q;s="}"+sharpnr.await.compiler.buildStatement(a.substring(h+"$$".length,g)+");",c,{awaitMode:true})}return{output:r,outputEnd:s,cursor:k}};sharpnr.await.compiler.compile=function(a){var b=sharpnr.await.compiler.buildStatement(a);var c=sharpnr.await.compiler.buildStatement(b,0,{awaitMode:true});if(b==c){if(console){console.log("AWAIT WARNING: Unnecessary async modifier. ("+c+")")}}try{var d=eval_global("("+c+");")}catch(e){if(console){console.log("AWAIT ERROR: Unknown compiler error. ("+c+")")}}return d};var $$={};var await={};sharpnr.jinq={debug:true,order:{" ":0,"!":0,'"':0,"'":0,"#":0,$:0,"%":0,"&":0,"(":0,")":0,"*":0,"+":0,",":0,"-":0,".":0,"/":0,":":0,";":0,"<":0,">":0,"=":0,"?":0,"@":0,"[":0,"]":0,"\\":0,"^":0,_:0,"{":0,"}":0,"|":0,"~":0,0:1,1:2,2:3,3:4,4:5,5:6,6:7,7:8,8:9,9:10,a:11,A:11,"á":11,"Á":11,b:12,B:12,c:13,C:13,d:14,D:14,e:15,E:15,"é":15,"É":15,f:16,F:16,g:17,G:17,h:18,H:18,i:19,I:19,"í":19,"Í":19,j:20,J:20,k:21,K:21,l:22,L:22,m:23,M:23,n:24,N:24,o:25,O:25,"ó":25,"Ó":25,"ö":26,"Ö":26,"õ":26,"Õ":26,p:27,P:27,q:28,Q:28,r:29,R:29,s:30,S:30,t:31,T:31,u:32,U:32,"ú":32,"Ú":32,"ü":33,"Ü":33,"û":33,"Û":33,v:34,V:34,w:35,W:35,x:36,X:36,y:37,Y:37,z:38,Z:38},range:function(a,b){if(a){var c=[];for(var d=b||0;d<(b?b+a:a);d++){c.push(d)}return c}return null},sequence:function(a,b,c){if(a&&b){if(typeof a=="function"){var d=[];for(var e=c||0;e<(c?c+b:b);e++){d.push(a(e))}return d}else if(typeof a=="string"){a=sharpnr.jinq.$parseLambda(a);if(a){return sharpnr.jinq.sequence(a,b,c)}}else{if(sharpnr.jinq.debug){console.log("JINQ Exception: invalid rule given on JINQ.sequence()")}}}return null},$paramCount:function(a){if(a.indexOf("=>")==-1){return null}var b=a.split("=>")[0].replace("(","").replace(")","").removeSpaces().split(",");var c=0;for(var d=0;d<b.length;d++){if(b[d]){c++}}return c},$parseLambda:function(a,b){if(a.indexOf("=>")==-1){if(sharpnr.jinq.debug){console.log("JINQ Exception: Unparsable lambda expression: '"+a+"'")}return null}try{var c=a.indexOf("{");if(c>-1&&a.lastIndexOf("}")>c){var d=a.substring(c,a.lastIndexOf("}")+1);if(!sharpnr.jinq.$isObjectLiteral(d)){var e=a.substring(0,a.indexOf("=>")).replace("(","").replace(")","");var f=a.substring(a.indexOf("=>")+2).replace("{","");f=f.substring(0,f.lastIndexOf("}")-1);var g="";var h="";if(b){for(var i in b){g+="var {0} = $obj.{1}; ".format(i,i);h+="$obj.{0} = {1}; ".format(i,i)}}var j=f.indexOf("return");if(j>-1){f=f.insert(h,j)}else{f=f+h}var k=new Function(e,g+f);if(b){k=k.wrap(b)}return k}else{var l=a.substring(0,a.indexOf("=>"));alert("{0} => { return {1}; }".format(l,d));return sharpnr.jinq.$parseLambda("{0} => { return {1}; }".format(l,d))}}else{var e=a.substring(0,a.indexOf("=>")).replace("(","").replace(")","");var f=a.substring(a.indexOf("=>")+2);var g="";if(b){for(var i in b){g+="var {0} = $obj.{1}; ".format(i,i)}}var k=new Function(e,"{0}return ( {1} );".format(g,f));if(b){k=k.wrap(b)}return k}}catch(m){if(sharpnr.jinq.debug){console.log("JINQ Exception: Unparsable lambda expression: '"+a+"'")}return null}},$extend:function(a,b){if(typeof a==="object"&&typeof b==="object"){var c={};if(Object.keys(a).length>0){c=sharpnr.jinq.$extend(c,a)}for(var d in b){c[d]=b[d]}return c}else{if(sharpnr.jinq.debug){console.log("JINQ Exception: invalid objects given on JINQ.extend()")}return null}},$isObjectLiteral:function(a){}};Function.prototype.wrap=function(a){return(new Function("$obj","return {0};".format(this)))(a)};String.prototype.insert=function(a,b){return this.substring(0,b)+a+this.substring(b)};String.prototype.format=function(){var a=arguments;var b=RegExp("{([0-"+(arguments.length-1)+"])}","g");return this.replace(b,function(b,c){return a[c]})};String.prototype.removeSpaces=function(){return this.replace(/\s/g,"")};(function(a){String.prototype.l=String.prototype.lambda=function(){var b=Array.prototype.slice.call(arguments),c=null;if(a.$paramCount(this)<b.length){c=b[b.length-1];b.splice(b.length,1)}return a.$parseLambda(this,c).apply(null,b)};String.prototype.pl=String.prototype.parseLambda=function(b){return a.$parseLambda(this,b)};Object.prototype.asArray=function(){if(!this){return null}var a=[];for(var b in this){if(this instanceof Array&&this.constructor===Array&&b==="length"||b==="$attached"||!this.hasOwnProperty(b)){continue}a.push(this[b])}return a};Array.prototype.randomIndex=function(a,b){if(!this||!this.length){return null}else if(this.length==1){return 0}if(!a){a=0}if(!b){b=this.length}return Math.floor(Math.random()*(b-a))+a};Array.prototype.random=function(b){if(!this||!this.length){return null}else if(this.length==1){return this[0]}else{if(!b){return this[this.randomIndex()]}if(typeof b=="function"){var c=[];var d=this[this.randomIndex()];while(true){if(c.length<this.length){if(!b(d)){if(!c.contains(d)){c.push(d)}d=this[this.randomIndex()]}else{return d}}else{return null}}return d}else if(typeof b=="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.random(b)}}else{if(a.debug){console.log("JINQ Exception: invalid predicate given on Array.random()")}return null}}};Array.prototype.min=function(b){if(this.length==0){return null}var c=this[0];if(!b){for(var d=1;d<this.length;d++){if(this[d]<c){c=this[d]}}return c}else if(typeof b==="function"){for(var d=1;d<this.length;d++){if(b(this[d])<b(c)){c=this[d]}}return c}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.min(b)}}else{if(a.debug){console.log("JINQ Exception: invalid selector given on Array.min()")}return null}return this};Array.prototype.max=function(b){if(this.length==0){return null}var c=this[0];if(!b){for(var d=1;d<this.length;d++){if(this[d]>c){c=this[d]}}return c}else if(typeof b==="function"){for(var d=1;d<this.length;d++){if(b(this[d])>b(c)){c=this[d]}}return c}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.max(b)}}else{if(a.debug){console.log("JINQ Exception: invalid selector given on Array.max()")}return null}return this};Array.prototype.sum=function(b){var c=0;if(!b){for(var d=0;d<this.length;d++){c+=this[d]}return c}else if(typeof b==="function"){for(var d=0;d<this.length;d++){c+=b(this[d])}return c}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.sum(b)}}else{if(a.debug){console.log("JINQ Exception: invalid selector given on Array.sum()");return null}}return this};Array.prototype.take=function(a,b){var c=[];if(!a){return this}else{for(var d=b||0;d<(b?b+a:a);d++){c.push(this[d])}}c.$attached=this.$attached;return c};Array.prototype.contains=function(a){if(Array.prototype.indexOf){return this.indexOf(a)>-1}else{for(var b=0;b<this.length;b++){if(this[b]===a){return true}}return false}};Array.prototype.select=function(b){var c=[];if(typeof b==="function"){for(var d=0;d<this.length;d++){c.push(b(this[d]))}c.$attached=this.$attached;return c}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.select(b)}}else{if(a.debug){console.log("JINQ Exception: invalid selector given on Array.select()");return null}}return this};Array.prototype.where=function(b){var c=[];if(typeof b==="function"){for(var d=0;d<this.length;d++){if(b(this[d])){c.push(this[d])}}c.$attached=this.$attached;return c}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.where(b)}}else{if(a.debug){console.log("JINQ Exception: invalid predicate given on Array.where()");return null}}return this};Array.prototype.single=function(b){if(this.length==0){return null}else{if(!b){if(this.length>1){return null}else{return this[0]}}else if(typeof b=="function"){var c=null;for(var d=0;d<this.length;d++){if(b(this[d])){if(c){return null}else{c=this[d]}}}return c}else if(typeof b=="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.single(b)}}else{if(a.debug){console.log("JINQ Exception: invalid predicate given on Array.single()")}}}return null};Array.prototype.first=function(b){if(this.length==0){return null}if(!b){return this[0]}else if(typeof b==="function"){var c=0;while(true){if(b(this[c])){return this[c]}else if(c==this.length-1){return null}c++}}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.first(b)}}else{if(a.debug){console.log("JINQ Exception: invalid predicate given on Array.first()")}}return null};Array.prototype.last=function(b){if(this.length==0){return null}if(!b){return this[this.length-1]}else if(typeof b==="function"){var c=this.length-1;while(true){if(b(this[c])){return this[c]}else if(c<=0){return null}c--}}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.last(b)}}else{if(a.debug){console.log("JINQ Exception: invalid predicate given on Array.last()")}}return null};Array.prototype.$reverse=Array.prototype.reverse;Array.prototype.reverse=function(){var a;if(!Array.prototype.$reverse){a=[];for(var b=this.length-1;b>=0;b--){a.push(this[b])}}else{a=this.$reverse()}a.$attached=this.$attached;return a};Array.prototype.combine=function(b){var c=[this];for(var d=1;d<arguments.length;d++){if(typeof arguments[d]==="object"&&arguments[d].length){c.push(arguments[d])}}if(c.length<=1){if(a.debug){console.log("JINQ Exception: Must give an array at least to Array.combine()")}return null}for(var d=0;d<c.length-1;d++){if(c[d].length!=c[d+1].length){if(a.debug){console.log("JINQ Exception: Array.combine() can join arrays only with the same length")}return null}}var e=[];if(typeof b==="function"){for(var d=0;d<this.length;d++){var f=[];for(var g=0;g<c.length;g++){f.push(c[g][d])}e.push(b.apply(this,f))}}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.combine.apply(this,Array.prototype.concat([b],c.slice(1)))}}else{if(a.debug){console.log("JINQ Exception: invalid selector given on Array.combine()")}return null}e.$attached=this.$attached;return e};Array.prototype.groupby=function(b){var c=[];if(typeof b=="function"){for(var d=0;d<this.length;d++){var e=b(this[d]);var f=c.attach({key:e}).first("n => n.key == key");if(f){f.values.push(this[d])}else{c.push({key:e,values:[this[d]]})}}c.$attached=this.$attached;return c}else if(typeof b=="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.groupby(b)}}else{if(a.debug){console.log("JINQ Exception: invalid selector given on Array.groupby()")}return null}return null};Array.prototype.orderby=function(b,d,e,f){if(!d){d=[].concat(this)}else{d=[].concat(d)}if(d.length<=1){return d}if(f!="asc"&&f!="desc"){f="asc"}var g;this.err=function(){if(a.debug){console.log("JINQ Exception: Array.orderby() can order arrays only if all its elements (or their selected properties) are either strings or numbers.")}};if(!b){if(typeof d[0]=="number"){g="number"}else if(typeof d[0]=="string"){g="string"}else{this.err();return null}if(g=="number"){var h=[],i=[];var j=d.randomIndex();var k=d[j];if(typeof k!=g){this.err();return null}else{d.splice(j,1)}for(var l=0;l<d.length;l++){if(typeof d[l]!=g){this.err();return null}if(d[l]<=k){h.push(d[l])}else{i.push(d[l])}}var m;if(f=="asc"){m=Array.prototype.concat(h.orderby(),k,i.orderby())}else{m=Array.prototype.concat(i.orderby(undefined,undefined,undefined,"desc"),k,h.orderby(undefined,undefined,undefined,"desc"))}m.$attached=d.$attached;return m}else{if(!e){e=0}var n=function(b){var c=a.order[b[e]];return c||-1};var o=[[]];ret=[],c=d.orderby(n),by=c[0][e];for(var l=0;l<c.length;l++){if(c[l][e]==by){o[o.length-1].push(c[l])}else{by=c[l][e];o.push([c[l]])}}for(var l=0;l<o.length;l++){if(o[l].length>1){ret=ret.$concat(o[l].orderby(null,null,e+1))}else{ret=ret.$concat(o[l])}}if(d.$attached){ret.$attached=d.$attached}return f=="asc"?ret:ret.$reverse()}}else if(typeof b=="function"){if(typeof b(d[0])=="number"){g="number"}else if(typeof b(d[0])=="string"){g="string"}else{this.err();return null}if(g=="number"){var h=[],i=[];var j=d.randomIndex();var k=d[j];if(typeof b(k)!=g){this.err();return null}else{d.splice(j,1)}for(var l=0;l<d.length;l++){if(typeof b(d[l])!=g){this.err();return null}if(b(d[l])<=b(k)){h.push(d[l])}else{i.push(d[l])}}var m;if(f=="asc"){m=Array.prototype.concat(h.orderby(b),k,i.orderby(b))}else{m=Array.prototype.concat(i.orderby(b,undefined,undefined,"desc"),k,h.orderby(b,undefined,undefined,"desc"))}m.$attached=d.$attached;return m}else{if(!e){e=0}var n=function(c){var d=a.order[b(c)[e]];return d||-1};var o=[[]];ret=[],c=d.orderby(n),by=b(c[0])[e];for(var l=0;l<c.length;l++){if(b(c[l])[e]==by){o[o.length-1].push(c[l])}else{by=b(c[l])[e];o.push([c[l]])}}for(var l=0;l<o.length;l++){if(o[l].length>1){ret=ret.$concat(o[l].orderby(b,null,e+1))}else{ret=ret.$concat(o[l])}}if(d.$attached){ret.$attached=d.$attached}return f=="asc"?ret:ret.$reverse()}}else if(typeof b=="string"){b=a.$parseLambda(b,d.$attached);if(b){return d.orderby(b,undefined,undefined,f)}}else{if(a.debug){console.log("JINQ Exception: invalid selector given on Array.orderby()")}return null}};Array.prototype.orderbydescending=Array.prototype.orderbydesc=Array.prototype.orderbyd=function(a,b){return this.orderby(a,b,undefined,"desc")};Array.prototype.foreach=function(b){if(typeof b==="function"){for(var c=0;c<this.length;c++){b(this[c])}return this}else if(typeof b==="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.foreach(b)}}else{if(a.debug){console.log("JINQ Exception: invalid action given on Array.forEach()")}return null}return this};Array.prototype.attach=function(){if(!this.$attached){this.$attached={}}for(arg in arguments){this.$attached=a.$extend(this.$attached,arguments[arg])}return this};Array.prototype.attached=function(b){if(b===null){this.$attached={}}else if(typeof b=="string"){b=a.$parseLambda(b,this.$attached);if(b){return this.attached(b)}}else if(typeof b=="function"){return b()}return this.$attached?this.$attached:null};Array.prototype.$concat=Array.prototype.concat;Array.prototype.concat=function(){var b=[];var c=this.$attached||{};for(var d=0;d<arguments.length;d++){if(arguments[d].$attached){c=a.$extend(c,arguments[d].$attached)}b.push(arguments[d])}var e=Array.prototype.$concat.apply(this,b);e.$attached=c;return e}})(sharpnr.jinq)